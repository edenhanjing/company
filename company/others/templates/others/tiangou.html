{% extends 'base.html' %}
{% load static %}

{% block title %}ä¿®æ”¹ä¸ªäººä¿¡æ¯{% endblock %}

{% block content%}
  <style>
  .label {
    cursor: pointer;
  }

  .img-container img {
    max-width: 100%;
  }
  .content-body{margin-top: 20px; }
  .button_{
    margin: 15px auto;
    width: 160px;
    border: none;
    border-radius: 5px;
    background: #6dad58;
    color: #fff;
    padding:5px;
    cursor:pointer;
    font-weight: 600;
  } 
  .button_:hover{
    background: #42752f;
  }

  </style>
  <style type="text/css">
    .user{
      padding: 2px ;
      margin: 5px;
      list-style: none;
      border-radius: 15px;
      border: 1px solid #808286;
      box-shadow: 0 2px 5px rgba(0,0,0,.1);
      overflow: hidden;
    }
    .user:hover{
      box-shadow: 0 5px 20px rgba(250,250,250,.1);
    }
    .user img{
      border-radius: 30px;
      width: 20px;
      height: 20px;
      overflow: hidden;
      margin: 0 auto;
      padding: 0;
      /*border: 2px solid rgba(255, 255, 255, 0.5);*/
      box-shadow:0 2px 5px rgba(0,0,0,.05);
      float: left;

    }
    .user .username{
      margin-left: 25px;
      color: #fff;

    }
    .emojioneemoji{
      font-size: inherit;
      height: 2ex;
      width: 2.1ex;
      min-height: 20px;
      min-width: 20px;
      display: inline-block;
      margin: -.2ex .15em .2ex;
      line-height: normal;
      vertical-align: middle;
      max-width: 100%;
      top: 0;
    }
    .emojionearea .emojionearea-editor{
      min-height: 5rem;
    }
    .box{
      max-width: 600px;
      margin:0 auto;
    }

    .some-box{
      float: left;
      max-width: 600px;
      margin:0 auto;
      border-radius: 10px;
      width: 100%;
    }
    .box-body{
      background: #f7f7f7;
      overflow:hidden;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,.2);
      height: 550px;
    }

    .chat-head{
      background:#ececec;
      padding: 5px 20px;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
      font-weight: large;
      font-size: 20px;
      color: #444752;
    }
    .chat-body{
      min-height: 455px;
      max-height: 800px;
      margin: 5px 0;
      
    }
    /* æ»šåŠ¨æ¡æ ·å¼è®¾ç½® */
    .messages-content::-webkit-scrollbar{/*æ»šåŠ¨æ¡æ•´ä½“éƒ¨åˆ†ï¼Œå…¶ä¸­çš„å±æ€§æœ‰width,height,background,borderç­‰*/
        width:5px; 
        background: black;
    }
    .messages-content::-webkit-scrollbar-track-piece{/*å†…å±‚è½¨é“ï¼Œæ»šåŠ¨æ¡ä¸­é—´éƒ¨åˆ†*/
        background:#f7f7f7;
    }
    .messages-content::-webkit-scrollbar-thumb{/*æ»šåŠ¨æ¡é‡Œé¢å¯ä»¥æ‹–åŠ¨çš„é‚£éƒ¨åˆ†*/
      background:#bbbbbb;
      border-radius:5px;
    }
    
    /* æ»šåŠ¨æ¡æ ·å¼è®¾ç½® ---- å®Œæˆ*/

    .messages-content{
      position: relative;
      padding:0px 2%;
      height: 455px;
      overflow:scroll;

    }
    .message{
      clear: both;
      font-size: 14px;
      padding: 6px 0;

    }
    .message:last-child {
      margin-bottom: 30px;
    }
    .new {
      -webkit-transform: scale(0);
              transform: scale(0);
      -webkit-transform-origin: 0 0;
              transform-origin: 0 0;
      -webkit-animation: bounce 500ms linear both;
              animation: bounce 500ms linear both;
    }
    .message-body{
      float: left;
      padding: 5px 10px 7px;
      border-radius: 5px 13px 13px 13px;
      background: rgb(255,255,255,.5);
      position: relative;
      margin: 1px 0;
      box-shadow: 0 3px 5px rgba(228, 227, 227, 0.42);;
      max-width: 80%;
    }
    .message-left{
      margin-left: 35px;
    }

    .message-right{
      float: right;
      border-radius: 13px 5px 13px 13px;
      background: #b2e281;
      
    }
    .message .avatar {
      position: absolute;
      z-index: 1;
      left: -35px;
      border-radius: 30px;
      width: 30px;
      height: 30px;
      overflow: hidden;
      margin: 0;
      padding: 0;
      border: 2px solid rgba(255, 255, 255, 0.5);
      box-shadow:0 2px 5px rgba(0,0,0,.05);
    }
    .message .avatar img {
      width: 100%;
      height: auto;
    }
    .username{
      font-size: 10px;
    }
    .message-timestamp{
      clear: both;
      text-align: center;
      height: 20px;
    }
    .timestamp{
      padding:0 5px 0 5px; 
      font-size: 10px;
      color: #555;
      border-radius: 5px;
      background: #ececec;
      height: 10px
    }

    .col-10 ,.col-2{
      padding: 0 1%;
    }

    .chat-footer{
      margin: 0;
      background: #f7f7f7;
    }
    .message-content{
      width: 100%;
      height: 90%;
    }
    .message-submit{
      width: 100%;
      height: 90%;
      color: #fff;
      border: none;
      background: #66a8ef;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 5px;
    }
    .message-submit:hover{
      background:#fff;
      color:#333;
    }

    @-webkit-keyframes bounce {
      0% {
        -webkit-transform: matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      4.7% {
        -webkit-transform: matrix3d(0.45, 0, 0, 0, 0, 0.45, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(0.45, 0, 0, 0, 0, 0.45, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      9.41% {
        -webkit-transform: matrix3d(0.883, 0, 0, 0, 0, 0.883, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(0.883, 0, 0, 0, 0, 0.883, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      14.11% {
        -webkit-transform: matrix3d(1.141, 0, 0, 0, 0, 1.141, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(1.141, 0, 0, 0, 0, 1.141, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      18.72% {
        -webkit-transform: matrix3d(1.212, 0, 0, 0, 0, 1.212, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(1.212, 0, 0, 0, 0, 1.212, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      24.32% {
        -webkit-transform: matrix3d(1.151, 0, 0, 0, 0, 1.151, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(1.151, 0, 0, 0, 0, 1.151, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      29.93% {
        -webkit-transform: matrix3d(1.048, 0, 0, 0, 0, 1.048, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(1.048, 0, 0, 0, 0, 1.048, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      35.54% {
        -webkit-transform: matrix3d(0.979, 0, 0, 0, 0, 0.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(0.979, 0, 0, 0, 0, 0.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      41.04% {
        -webkit-transform: matrix3d(0.961, 0, 0, 0, 0, 0.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(0.961, 0, 0, 0, 0, 0.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      52.15% {
        -webkit-transform: matrix3d(0.991, 0, 0, 0, 0, 0.991, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(0.991, 0, 0, 0, 0, 0.991, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      63.26% {
        -webkit-transform: matrix3d(1.007, 0, 0, 0, 0, 1.007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(1.007, 0, 0, 0, 0, 1.007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      85.49% {
        -webkit-transform: matrix3d(0.999, 0, 0, 0, 0, 0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(0.999, 0, 0, 0, 0, 0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
      100% {
        -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      }
    }
   
  </style>
<div class="container">
  <div class="content-body">
    <div class="tiangou_info" id='tiangou_info' style="text-align: center;">
      <div class="row" >
        <div class="col-md-12" >
          <label class="" data-toggle="tooltip" title="é€‰å–èˆ”ç‹—å¤´åƒ" style="background: #f5f5f5;border-radius: 5px;margin: 0 20px;box-shadow: 5px 5px 20px rgb(224, 224, 224);height: 160px;width: 160px;">
            <img class="rounded" id="avatar" src="/media/AvatarImage/default.png"  alt='é€‰å–èˆ”ç‹—å¤´åƒ' style="width: 160px;height: 160px;">
            <input type="file" class="sr-only" id="input" name="image" accept="image/*">
          </label>
          <p class="button_" onclick="getElementById('input').click()">é€‰å–èˆ”ç‹—å¤´åƒ</p>

          <div style="border: none;border-radius: 5px;box-shadow: 2px 3px 15px rgba(236, 236, 236, 0.5);background: #fff;width: 350px;margin: auto;">
            <span>èˆ”ç‹—åç§°ï¼š</span>
            <input type="" id='tiangou_name' name="tiangou_name" style="padding: 5px;border: none;" value="èˆ”ç‹—" >
          </div>
        </div>

      </div>
      <div  class="row">
        <span class="button_" onclick="info_seted()" id='start' style="margin-top:50px;">äº«å—è¢«èˆ”</span>
      </div>
    </div>

    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">é€‰å–å¤´åƒ</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body">
        <div class="img-container">
          <img id="image" src="https://avatars0.githubusercontent.com/u/3456749">
        </div>
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">å–æ¶ˆ</button>
        <button type="button" class="btn btn-primary" id="crop">ç¡®è®¤</button>
        </div>
      </div>
      </div>
    </div>



    <div class="box"  style="margin-top: 20px;">
      <div class="some-box " id='some-box' style="display: none" >
        <div class="box-body">
          <div class="chat-head">
            <span id='tiangou_name_'>èˆ”ç‹—</span>
          </div>
          <div class="chat-body">
            <div class="messages-content" id="messages-content">

            </div>
          </div>
          <div class="chat-footer row">
            <div class="col-10">
              <textarea class="message-content " rows=2 rows=2 id="emojione_text"></textarea>
            </div>
            <div class="col-2">
              <button class="message-submit" id="">å‘é€</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}

{% block script%}
<link rel="stylesheet" href="{% static 'cropper.css' %}">
<script src="{% static 'cropper.js' %}"></script>
<script src="{% static 'js/emojionearea.min.js' %}"></script>
<script type="text/javascript">
      $(document).ready(function() {
        window.emojioneVersion = "2.2.7";
          $("#emojione_text").emojioneArea({
            inline: true,
            autoHideFilters: true,
            search : false ,
            pickerPosition : 'top',
            tones:false,
          });
        });
    </script>
<script>
  var avatar = document.getElementById('avatar');
  var image = document.getElementById('image');
  var input = document.getElementById('input');
  var $modal = $('#modal');
  var cropper;

  $('[data-toggle="tooltip"]').tooltip();

  input.addEventListener('change', function (e) {
    var files = e.target.files;
    var done = function (url) {
      input.value = '';
      image.src = url;
      $modal.modal('show');
    };
    var reader;
    var file;
    var url;

    if (files && files.length > 0) {
      file = files[0];

      if (URL) {
      done(URL.createObjectURL(file));
      } else if (FileReader) {
      reader = new FileReader();
      reader.onload = function (e) {
        done(reader.result);
      };
      reader.readAsDataURL(file);
      }
    }
  });

  $modal.on('shown.bs.modal', function () {
    cropper = new Cropper(image, {
      aspectRatio: 1,
      viewMode: 3,
    });
  }).on('hidden.bs.modal', function () {
    cropper.destroy();
    cropper = null;
  });

  document.getElementById('crop').addEventListener('click', function () {
    var initialAvatarURL;
    var canvas;

    $modal.modal('hide');

    if (cropper) {
      canvas = cropper.getCroppedCanvas({
      width: 160,
      height: 160,
      });
      initialAvatarURL = avatar.src;
      avatar.src = canvas.toDataURL();
      

    }
  });

  function info_seted(){
    document.getElementById("tiangou_info").style.display="none";
    var tiangou_name = document.getElementById("tiangou_name").value;
    document.getElementById("tiangou_name_").innerHTML=tiangou_name;
    document.getElementById("some-box").style.display="contents";
    onmessage(rangenum(msg_list));
    start_tiangou();
  }
</script>
<script type="text/javascript">
  var d, h, m;
  var tiangou_name = document.getElementById("tiangou_name").value;

  function updateScrollbar(){
    var messages_content = document.getElementById('messages-content');
    messages_content.scrollTop = messages_content.scrollHeight;
  };
  function setDate(){
    d = new Date();
    if (m != d.getMinutes()) {
      m = d.getMinutes();
      $('<div class="message-timestamp"><span class="timestamp">'+ d.getHours() + ':' + m +'</span></div>').appendTo($('.messages-content'));
    };
  };

  function onmessage(msg) {
    setDate();
    $('<div class="message message-left new"><figure class="avatar"><img src='+avatar.src+'></figure><div class="username">'+'</div><div class="message-body ">'+msg+'</div></div>').appendTo($('.messages-content'));
    updateScrollbar();
  };

  function myonmessage(msg){
    setDate();
    $('<div class="message"><div class="message-body message-right new">' + msg + '</div></div>').appendTo($('.messages-content'));
    updateScrollbar();
  };
  //å‘é€ä¿¡æ¯
  $('.message-submit').click(function() {
    var messageInputDom = $('.emojionearea-editor');
    var message = messageInputDom.html();
    if ($.trim(message) != '') {
    myonmessage(message);
    if($.trim(message).indexOf('æ»š') != -1){
      onmessage('å¥½çš„ï¼Œæˆ‘æ»š1s');
    }
    else if($.trim(message).indexOf('çˆ±') != -1){
      onmessage('æˆ‘çˆ± æˆ‘çˆ± æˆ‘çˆ±ä½ ');
    }
    else{
      setTimeout(function() {onmessage(rangenum(msg_list2))},500+(Math.random() * 500));}
    messageInputDom.empty();
    messageInputDom.focus();
    }
    var emoji_html = $('.emojionearea-editor').html();
    console.log(emoji_html);
  });
  //é”®ç›˜enterå¿«æ·å‘é€ä¿¡æ¯
  $(window).on('keydown', function(e) {
    if (e.which == 13) {
      $('.message-submit').click();
      return false;
    }
  });
  //var msg_list = new Array()

  var msg_list=[
  'åœ¨å—ï¼Ÿ<img alt="ğŸ˜" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f601.png">',
  'æˆ‘å¾ˆæƒ³ä½ ã€‚',
  'æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ<img alt="ğŸ˜ƒ" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f603.png">',
  'æœ‰ä»€ä¹ˆå¿ƒäº‹å‘Šè¯‰æˆ‘ã€‚', 
  'ä¸ºä»€ä¹ˆä¸ç†æˆ‘å•Š?<img alt="ğŸ˜" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f61e.png"><img alt="ğŸ˜" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f61e.png"><img alt="ğŸ˜" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f61e.png">',
  'å›æˆ‘ä¸ªæ¶ˆæ¯å¥½ä¸å¥½ï¼Ÿ<img alt="ğŸ˜…" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f605.png">', 
  'ä½ åœ¨å¹²å˜›å‘¢åŠå¤©ä¸å›æ¶ˆæ¯ï¼Ÿ',
  'åœ¨ä¸åœ¨ï¼Ÿä½ å¿™å¯ä»¥å‘Šè¯‰æˆ‘ä¸€ä¸‹å•Šæˆ‘ä¸€ç›´åœ¨ç­‰ä½ å‘¢ã€‚' ,
  'æˆ‘çˆ±ä½ ',
  'æˆ‘å–œæ¬¢ä½ ',
  'ä½ æ€ä¹ˆé‚£ä¹ˆå¥½çœ‹<img alt="ğŸ˜Ÿ" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f61f.png">',
  'ä½ çœŸå¥½çœ‹<img alt="â™¥" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/2665.png">', 
  'ä½ æ˜¯æ€ä¹ˆé•¿å¾—è¿™ä¹ˆå¥½çœ‹çš„ï¼Ÿ',
  'ç›¸ä¿¡æˆ‘ï¼Œæˆ‘å¯ä»¥å¯¹ä½ å¥½ä¸€è¾ˆå­ã€‚',
  'å…¶ä»–ç”·ç”Ÿéƒ½æ˜¯ç”œè¨€èœœè¯­ä½†æˆ‘ä¸ä¼šã€‚',
  'å‡ºæ¥åƒä¸ªé¥­å§ï¼Ÿç«é”…å¥½ä¸å¥½ï¼Ÿ',
  'æˆ‘åˆå–é…’äº†ï¼Œå¤´ç—›çš„æ„Ÿè§‰æ¯”å¿ƒç—›å¥½å¤šäº†ã€‚<img alt="ğŸ˜­" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f62d.png"><img alt="ğŸ˜­" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f62d.png">',
  'æ„Ÿè§‰å¥½æƒ³æ­»å•Šï¼Œçˆ±ä¸€ä¸ªäººå¥½éš¾å•Šï¼',
  'ä½ èƒ½å›æˆ‘æ¶ˆæ¯æˆ‘å°±å¼€å¿ƒå¾—ä¸å¾—äº†ã€‚', 'åœ¨ä¸€èµ·å¥½ä¸å¥½ï¼Ÿæˆ‘ä¸€å®šå¯¹ä½ å¥½ã€‚',
  'å¯¹ä½ æ—¥æ—¥æƒ³å¿µï¼Œé™ªæˆ‘è¯´ç‚¹è¯å¥½ä¸å¥½ï¼Ÿ','æˆ‘æƒ³è§†é¢‘ä¸€ä¼šï¼Œä¸€åˆ†é’Ÿï¼',
  'æˆ‘æ„¿æ„æŠŠæˆ‘çš„ä¸€åˆ‡ç»™ä½ ï¼','è®©æˆ‘ä½è¿›ä½ çš„å¿ƒé‡Œã€‚',
  'æˆ‘ï¼Œ'+tiangou_name,'å¯¹ç€è¿™ä¸ªå¤©,å¯¹ç€è¿™ä¸ªåœ°,å‘èª“','æ°¸è¿œéƒ½è¦å’Œä½ åœ¨ä¸€èµ·ï¼',
  'ä¸€æ—¥ä¸è§ï¼Œæ€ä½ å¦‚ç‹‚',
  'â€œ æ™šå®‰ â€',
  '<img src="http://127.0.0.1:8000/media/aini.jpg" style="height: 100px;">',
  '<img src="http://127.0.0.1:8000/media/aini2.jpg" style="height: 100px;">',
  '<img src="http://127.0.0.1:8000/media/aini2.jpeg" style="height: 100px;">',
  '<img src="http://127.0.0.1:8000/media/aini3.jpg" style="height: 100px;">',
  '<img src="http://127.0.0.1:8000/media/hongbao.gif" style="height: 100px;">',
  '<img alt="ğŸ˜˜" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f618.png"><img alt="ğŸ˜˜" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f618.png"><img alt="ğŸ˜˜" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f618.png">çˆ±ä½ å“Ÿ',
  '<img alt="ğŸ˜š" class="emojioneemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f61a.png">',

  ];

  var msg_list2=[
  'ä½ ç»ˆäºè‚¯å›æˆ‘æ¶ˆæ¯äº†',
  'wawawaa,æˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†',
  'è¯·ä¿æŒå’Œæˆ‘é€šä¿¡ï¼Œæˆ‘ä¸èƒ½æ²¡æœ‰ä½ ',
  'å—¯å—¯å—¯ï¼Œä½ è¯´ä»€ä¹ˆéƒ½å¯¹',]

  function rangenum(array){
    var value = array[Math.round(Math.random()*(array.length-1))];  //éšæœºæŠ½å–ä¸€ä¸ªå€¼
    return(value);
  };


  function put_msg(){
    result = rangenum(msg_list);
    setTimeout(function() {onmessage(result)},500+(Math.random() * 1000));

  };
  function start_tiangou(){
    setInterval(function() {put_msg()},1500);
  };

</script>
{% endblock %}

